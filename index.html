<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vitals Trend Explorer</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
</head>
<body>

  <div class="dark-toggle">
    <label>
      <input type="checkbox" id="darkModeToggle"> Dark Mode
    </label>
  </div>

  <div id="tooltip"></div>
  <section id="overview">
    <h2>Overview</h2>
    <p>
      This interactive dashboard allows you to explore patient vitals recorded in real-time during surgical procedures. 
      By selecting different vital signs and grouping variables, you can visualize how physiological signals 
      like heart rate, blood pressure, and oxygen saturation vary across types of surgeries and emergency conditions.
      Highlighted danger zones and interactive legends help identify trends that may correspond with risk factors 
      during operations. This tool is designed for researchers, clinicians, and students interested in perioperative data.
    </p>
  </section>

  <section id="instructions">
    <h2>How to Use</h2>
    <ul>
      <li><strong>Vital:</strong> Choose a vital sign <span title="e.g., HR, MAP, SpO₂, Stability Index"></span></li>
      <li><strong>Group By:</strong> Compare trends by surgery type or emergency status</li>
      <li><strong>Legend:</strong> Click to toggle visibility, hover to isolate a group</li>
      <li><strong>Plot:</strong> Hover on the chart to view mean values and standard deviations over time</li>
    </ul>
  </section>

  <section id="data-info">
    <h2>About the Dataset</h2>
    <p>
      The visualizations are powered by data from the 
      <a href="https://vitaldb.net/dataset/" target="_blank" rel="noopener">VitalDB</a> project, 
      which contains biosignal recordings from <strong>6,388 surgeries</strong> performed at Seoul National University Hospital in South Korea. 
      These surgeries were conducted between 2005 and 2014. The dataset provides synchronized, high-frequency intraoperative data 
      collected from anesthesia machines and monitoring devices at a 1–500 Hz sampling rate. Each surgery record includes time-series 
      measurements such as heart rate (HR), mean arterial pressure (MAP), oxygen saturation (SpO₂), and additional metadata such as 
      type of surgery, emergency status, and outcome labels.
    </p>
    <ul>
      <li><strong>signal:</strong> The type of biosignal (e.g., HR, MAP, SpO₂)</li>
      <li><strong>value:</strong> The measured value at a given time</li>
      <li><strong>norm_time:</strong> Normalized surgery timeline from 0 (start) to 1 (end)</li>
      <li><strong>optype:</strong> Type of surgery performed</li>
      <li><strong>emop:</strong> Whether the surgery was performed under emergency conditions</li>
    </ul>
  </section>

  <h1>Vitals Over Time</h1>

  <div id="controls">
    <label for="vitalSelect">Vital:</label>
    <select id="vitalSelect"></select>

    <label for="groupSelect">Group By:</label>
    <select id="groupSelect"></select>
  </div>

  <div id="chart-container">
    <svg width="900" height="500"></svg>
    <div id="legend"></div>
  </div>

  <section id="rationale">
    <h2>Design Rationale</h2>
  
    <h3>Normalized Time Axis</h3>
    <p>
      We used a normalized time axis instead of actual timestamps because surgeries vary a lot in duration. Plotting them on a shared 0–100% timeline made it easier to compare trends across procedures. This helped us keep the focus on how vitals changed during the surgery—not how long the surgery was. We considered including actual time, but that made overlapping trends hard to read and created scaling problems, especially when comparing emergency and elective cases.
    </p>
  
    <h3>Vital Selection</h3>
    <p>
      We focused on MAP, heart rate, SpO₂, and the Stability Index because they reflect different aspects of patient stability and were consistently recorded across cases. These vitals are also ones clinicians care about during surgery. We originally looked at including more signals like ETCO₂, BIS, and drug doses, but those were either missing for too many patients or had a lot of noise. Sticking to core vitals made the trends more reliable and easier to interpret.
    </p>
  
    <h3>Interactive Hover and Tooltips</h3>
    <p>
      We added hover lines and tooltips to let users trace exact mean and standard deviation values over time. Just looking at lines wasn’t enough—we wanted users to know exactly when a group’s vitals dropped or spiked. Tooltips were tricky at first because they broke when groups were toggled off or had missing values. We debugged this by making sure the hover event always found the closest valid data point, even with gaps or filters applied.
    </p>
  
    <h3>Grouping by Surgery Type or Emergency Status</h3>
    <p>
      Grouping vitals by either <code>optype</code> (surgery type) or <code>emop</code> (emergency status) gave users more flexibility in exploring patterns. For example, someone might want to know how vitals behave in orthopedic surgeries vs. abdominal ones—or in emergency vs. elective cases. We thought about grouping by sex or ASA status too, but those had too many small subgroups, and the plots became too cluttered to read clearly.
    </p>
  
    <h3>Danger Zones</h3>
    <p>
      We created soft-colored danger zones for each vital to highlight when values moved into risky ranges. For instance, a MAP below 60 mmHg might signal hypoperfusion. These zones helped users visually identify instability without needing to memorize clinical thresholds. We tried showing alerts or binary flags at first, but those didn’t convey how long a value stayed in the danger range, which we felt was more important for understanding risk over time.
    </p>
  
    <h3>Dark Mode and Accessibility</h3>
    <p>
      We added dark mode and carefully chose colors to make the visualization accessible to more users. Many people work in low-light environments, especially in clinical settings, and we wanted the chart to still feel readable and professional. We also made sure axis labels and lines stayed visible in both light and dark mode, testing multiple combinations until we found ones that didn’t cause strain or confusion.
    </p>
  
    <h3>Legend Filtering and Highlighting</h3>
    <p>
      To avoid overwhelming users with too many lines, we made the legend interactive. Users can click to hide or isolate groups, and hover to highlight a line. Early versions of our plot looked chaotic when too many surgery types were shown at once. Adding filtering gave users control over what they were seeing and made the experience feel more focused. This also made it easier to debug group-specific patterns.
    </p>
  
    <h3>Stability Index</h3>
    <p>
      We introduced the stability index to provide a single, interpretable metric that summarizes a patient's overall physiological state throughout surgery, making it easier to compare trends across different surgery types and anesthetic strategies. Plotting individual vitals like MAP, HR, SpO₂, ETCO₂, and BIS separately would clutter the visualization and make interpretation difficult, especially at scale. To create the index, we normalized each vital within clinically meaningful ranges (e.g., MAP: 50–110 mmHg, SpO₂: 85–100%) and averaged the values, ensuring the index was both scale-independent and clinically relevant. We considered alternatives like weighting vitals differently, but chose this approach for effectively visualizing how patients fared throughout surgery, across different surgery types. So, the stability index feature offers a clean way to track and compare patient stability over time.
    </p>

    <h2>Development Process</h2>
    <ul>
      <li><strong>Time Spent:</strong></li>
      <li><strong>Task Division:</strong>
        <ul>
          <li style="margin-bottom: 1em;"><strong>Christian:</strong> Christian contributed over 20 people-hours to the project, focusing on HTML and CSS structure, including dark mode for better readability. He led debugging efforts and helped preprocess the dataset to support cleaner visualizations. He spent over 8 hours developing an alternate approach centered on individual patient data. Although this version was eventually scrapped due to limited data, it provided useful insights that guided the team toward group-level analysis.
            Christian implemented interactive features like the selectable legend and hover functionality. He also introduced shaded danger zones for vitals like MAP, improving clinical interpretability. Finally, he enhanced the tooltip to include contextual statistics such as mean, standard deviation, and z-score, allowing users to better interpret variability in vital signs.</li>
            <li style="margin-bottom: 1em;"><strong>Nanda:</strong> Nanda contributed to the project by implementing the interactive hover feature, which displays contextual statistics for each data point along the stability lines, enhancing user engagement and interpretability. She also developed the stability index metric to consolidate multiple vital signs into a single score, enabling clearer comparisons across surgeries. Additionally, she supported the data preparation process by assisting in cleaning and merging the surgical vital sign datasets to ensure accurate and consistent analysis.</li>
            <li style="margin-bottom: 1em;"><strong>Jiya:</strong> Jiya downloaded and explored the dataset to help identify which vital signs were most reliable and relevant for visualization. She built the base D3 chart and worked on setting up the x and y axes, adjusting the scaling to fit different vitals and especially handling the edge cases for Stability Index. She also styled the legend for clarity and debugged tooltip issues, making sure tooltips displayed correctly when switching between groups. Throughout development, she focused on improving the overall readability and usability of the chart so that users could clearly see how vitals changed across different surgery types.</li>
          <li style="margin-bottom: 1em;"><strong>Aarshia:</strong>Aarshia explored the dataset to identify additional variables that could add value to our visualization, such as lab results, medications, and event timelines. She investigated how often these features appeared across surgeries and helped assess whether they were consistent enough to be used. Even though we ultimately decided not to include them due to data sparsity, her exploration helped shape the scope of the project and kept us focused on signals that would be most meaningful and interpretable across all surgeries.</li>
        </ul>
      </li>
      <li><strong>Challenges:</strong> 
        <ul>
          <li>Tooltip not working with missing data — fixed by filtering empty groups.</li>
          <li>Y-axis scaling for stability index needed custom logic because the range varied a lot.</li>
          <li>We initially tried using absolute time but normalized time made more sense for comparison.</li>
        </ul>
      </li>
    </ul>
  </section>

  <footer>
    <p class="footer-note">
      Dataset: <a href="https://vitaldb.net/dataset/" target="_blank" rel="noopener">VitalDB</a> |
      Visualization by Christian Kumagai, Nanda Payyappilly, Jiya Makhija, Aarshia Gupta using D3.js
    </p>
  </footer>

  <script>
    const toggle = document.getElementById('darkModeToggle');
    toggle.addEventListener('change', () => {
      document.body.classList.toggle('dark-mode', toggle.checked);
    });
  </script>
  <script src="plot.js"></script>
</body>
</html>
