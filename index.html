<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vitals Trend Explorer</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
</head>
<body>

  <div class="dark-toggle">
    <label>
      <input type="checkbox" id="darkModeToggle"> Dark Mode
    </label>
  </div>

  <div id="tooltip"></div>
  <section id="overview">
    <h2>Overview</h2>
    <p>
      This interactive dashboard allows you to explore patient vitals recorded in real-time during surgical procedures. 
      By selecting different vital signs and grouping variables, you can visualize how physiological signals 
      like heart rate, blood pressure, and oxygen saturation vary across types of surgeries and emergency conditions.
      Highlighted danger zones and interactive legends help identify trends that may correspond with risk factors 
      during operations. This tool is designed for researchers, clinicians, and students interested in perioperative data.
    </p>
  </section>

  <section id="instructions">
    <h2>How to Use</h2>
    <ul>
      <li><strong>Vital:</strong> Choose a vital sign <span title="e.g., HR, MAP, SpO₂, Stability Index"></span></li>
      <li><strong>Group By:</strong> Compare trends by surgery type or emergency status</li>
      <li><strong>Legend:</strong> Click to toggle visibility, hover to isolate a group</li>
      <li><strong>Plot:</strong> Hover on the chart to view mean values and standard deviations over time</li>
    </ul>
  </section>

  <section id="data-info">
    <h2>About the Dataset</h2>
    <p>
      The visualizations are powered by data from the 
      <a href="https://vitaldb.net/dataset/" target="_blank" rel="noopener">VitalDB</a> project, 
      which contains biosignal recordings from <strong>6,388 surgeries</strong> performed at Seoul National University Hospital in South Korea. 
      These surgeries were conducted between 2005 and 2014. The dataset provides synchronized, high-frequency intraoperative data 
      collected from anesthesia machines and monitoring devices at a 1–500 Hz sampling rate. Each surgery record includes time-series 
      measurements such as heart rate (HR), mean arterial pressure (MAP), oxygen saturation (SpO₂), and additional metadata such as 
      type of surgery, emergency status, and outcome labels.
    </p>
    <ul>
      <li><strong>signal:</strong> The type of biosignal (e.g., HR, MAP, SpO₂)</li>
      <li><strong>value:</strong> The measured value at a given time</li>
      <li><strong>norm_time:</strong> Normalized surgery timeline from 0 (start) to 1 (end)</li>
      <li><strong>optype:</strong> Type of surgery performed</li>
      <li><strong>emop:</strong> Whether the surgery was performed under emergency conditions</li>
    </ul>
  </section>

  <h1>Vitals Over Time</h1>

  <div id="controls">
    <label for="vitalSelect">Vital:</label>
    <select id="vitalSelect"></select>

    <label for="groupSelect">Group By:</label>
    <select id="groupSelect"></select>
  </div>

  <div id="chart-container">
    <svg width="900" height="500"></svg>
    <div id="legend"></div>
  </div>

  <section id="writeup">
    <h2>Design Rationale</h2>
    <ul>
      <li>
        <li><strong>Vital Selection:</strong> We chose MAP, heart rate, SpO₂, and a calculated Stability Index because they reflect different aspects of a patient’s condition during surgery. These signals were consistently present across the dataset and offered a balanced view of physiological stability. The Stability Index was computed as the average of three normalized values — MAP (mean arterial pressure), HR (heart rate), and SpO₂ (oxygen saturation) — rescaled to a 0–1 range and averaged at each time point. This gave us a composite metric to highlight overall stability or instability during surgery.</li>
      </li>
      <li>
        <strong>Normalized Time Axis:</strong> We displayed time as a normalized percentage to fairly compare across surgeries of different lengths. Absolute timestamps were confusing when durations varied.
      </li>
      <li>
        <strong>Danger Zones:</strong> Soft-colored background regions help show when values go out of normal clinical ranges. This lets users spot risky periods quickly.
      </li>
      <li>
        <strong>Interactivity:</strong> Hover tooltips, dynamic axes, and legend filtering all make the chart more engaging and let users explore different trends without cluttering the display.
      </li>
      <li>
        <strong>Dark Mode:</strong> We implemented dark mode with automatic color adjustments to improve readability and accessibility in different lighting conditions.
      </li>
    </ul>

    <h2>Development Process</h2>
    <ul>
      <li><strong>Time Spent:</strong></li>
      <li><strong>Task Division:</strong>
        <ul>
          <li><strong>Christian:</strong> Integrated all components into the webpage and ensured visual and interactive consistency across views.</li>
          <li><strong>Nanda:</strong> Helped with data cleaning and merging, styled UI controls, implemented dark mode, and wrote the project overview and user guide.</li>
          <li><strong>Jiya:</strong> Downloaded and cleaned the dataset, created the base D3 chart, fixed axis scaling, styled the legend, and debugged tooltip issues.</li>
          <li><strong>Aarshia:</strong> Explored the dataset to identify potential variables like lab results and drugs for future analysis or features.</li>
        </ul>
      </li>
      <li><strong>Challenges:</strong> 
        <ul>
          <li>Tooltip not working with missing data — fixed by filtering empty groups.</li>
          <li>Y-axis scaling for stability index needed custom logic because the range varied a lot.</li>
          <li>We initially tried using absolute time but normalized time made more sense for comparison.</li>
        </ul>
      </li>
    </ul>
  </section>

  <footer>
    <p class="footer-note">
      Dataset: <a href="https://vitaldb.net/dataset/" target="_blank" rel="noopener">VitalDB</a> |
      Visualization by Christian Kumagai, Nanda Payyappilly, Jiya Makhija using D3.js
    </p>
  </footer>

  <script>
    const toggle = document.getElementById('darkModeToggle');
    toggle.addEventListener('change', () => {
      document.body.classList.toggle('dark-mode', toggle.checked);
    });
  </script>
  <script src="plot.js"></script>
</body>
</html>
